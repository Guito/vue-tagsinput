(function(e,m){typeof exports=="object"&&typeof module<"u"?m(require("vue")):typeof define=="function"&&define.amd?define(["vue"],m):(e=typeof globalThis<"u"?globalThis:e||self,m(e.Vue))})(this,function(e){"use strict";const m="",A=e.createTextVNode(" tags input "),L={class:"tags-input-root",style:{position:"relative"}},I=["innerHTML"],N=["onClick"],O=["id","name","placeholder","value","onKeydown","onKeyup"],$={key:0,style:{display:"none"}},D=["name","value"],R=["textContent"],K=["innerHTML","onMouseover","onMousedown"],H=["textContent"],V=["innerHTML","onMouseover","onMousedown"],z={__name:"TagsInput",props:{elementId:String,inputId:String,existingTags:{type:Array,default:()=>[]},value:{type:Array,default:()=>[]},idField:{type:String,default:"key"},textField:{type:String,default:"value"},displayField:{type:String,default:null},valueFields:{type:String,default:null},disabled:{type:Boolean,default:!1},typeahead:{type:Boolean,default:!1},typeaheadStyle:{type:String,default:"badges"},typeaheadActivationThreshold:{type:Number,default:1},typeaheadMaxResults:{type:Number,default:0},typeaheadAlwaysShow:{type:Boolean,default:!1},typeaheadShowOnFocus:{type:Boolean,default:!0},typeaheadHideDiscard:{type:Boolean,default:!1},typeaheadUrl:{type:String,default:""},typeaheadCallback:{type:Function,default:null},placeholder:{type:String,default:"Add a tag"},discardSearchText:{type:String,default:"Discard Search Results"},limit:{type:Number,default:0},hideInputOnLimit:{type:Boolean,default:!1},onlyExistingTags:{type:Boolean,default:!1},deleteOnBackspace:{type:Boolean,default:!0},allowDuplicates:{type:Boolean,default:!1},validate:{type:Function,default:()=>!0},addTagsOnComma:{type:Boolean,default:!1},addTagsOnSpace:{type:Boolean,default:!1},addTagsOnBlur:{type:Boolean,default:!1},wrapperClass:{type:String,default:"tags-input-wrapper-default"},sortSearchResults:{type:Boolean,default:!0},caseSensitiveTags:{type:Boolean,default:!1},beforeAddingTag:{type:Function,default:()=>!0},beforeRemovingTag:{type:Function,default:()=>!0}},emits:["initialized","change","input","limit-reached","tag-added","tags-updated","tag-removed","tags-updated","keyup","keydown","focus","click","blur"],setup(i,{emit:d}){const t=i;e.ref(0);const o=e.ref([]),u=e.ref(""),S=e.ref(""),J=e.ref(""),r=e.ref([]),c=e.ref(0);e.ref(1);const k=e.ref(!1),F=e.ref(!1),f=e.ref(),T=e.ref(null);e.onMounted(()=>{f.value=M(t.existingTags),C(),t.typeaheadAlwaysShow&&h(),d("initialized"),addEventListener("click",a=>{a.target!==T.value&&y()})});const Q=e.computed(()=>t.hideInputOnLimit&&t.limit>0&&o.value.length>=t.limit||t.disabled);e.watch(u.value,(a,l)=>{h(),a.length&&a!=l&&(a.substring(l.length,a.length),t.addTagsOnSpace&&a.endsWith(" ")&&(u.value=a.trim(),t.tagFromInput(!0)),t.addTagsOnComma&&(a=a.trim(),a.endsWith(",")&&(u.value=a.substring(0,a.length-1),t.tagFromInput(!0))),d("change",a))}),e.watch(t.existingTags,a=>{f.value.splice(0),f.value=M(a),h()}),e.watch(o.value,()=>{J.value=JSON.stringify(o.value),d("update:modelValue",o.value)}),e.watch(t.value,()=>{C()}),e.watch(t.typeaheadAlwaysShow,a=>{a?h():y()});const g=a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),q=(a=!1)=>{if(!F.value)if(r.value.length&&c.value>=0&&!a)b(r.value[c.value]),u.value="";else{let l=u.value.trim();if(!t.onlyExistingTags&&l.length&&t.validate(l)){u.value="";let n={[t.idField]:"",[t.textField]:l};const s=g(t.caseSensitiveTags?n[t.textField]:n[t.textField].toLowerCase());for(let p of f.value){const se=g(t.caseSensitiveTags?p[t.textField]:p[t.textField].toLowerCase());if(s===se){n=Object.assign({},p);break}}v(n)}}},B=a=>{b(a),T.value.blur()},b=a=>{y(),v(a),e.nextTick(()=>{u.value="",S.value=""})},v=(a,l=!1)=>{if(!(t.disabled&&!l)){if(!t.beforeAddingTag(a))return!1;if(t.limit>0&&o.value.length>=t.limit)return d("limit-reached"),!1;E(a)||(o.value.push(a),e.nextTick(()=>{d("tag-added",a),d("tags-updated")}))}},W=()=>{!u.value.length&&this.deleteOnBackspace&&o.value.length&&w(o.value.length-1)},w=a=>{if(t.disabled)return;let l=o.value[a];if(!beforeRemovingTag(l))return!1;o.value.splice(a,1),e.nextTick(()=>{d("tag-removed",l),d("tags-updated"),t.typeaheadAlwaysShow&&h()})},h=()=>{if(t.typeahead!==!0)return!1;if(S.value!=u.value||!r.value.length&&t.typeaheadActivationThreshold==0||t.typeaheadAlwaysShow||this.typeaheadShowOnFocus){!typeaheadUrl.value.length&&!t.typeaheadCallback&&(r.value=[]),c.value=0;let a=a.value.trim();if(a.length&&a.length>=t.typeaheadActivationThreshold||t.typeaheadActivationThreshold==0||t.typeaheadAlwaysShow){const l=g(t.caseSensitiveTags?a:a.toLowerCase());if(t.typeaheadCallback)t.typeaheadCallback(l).then(n=>{f.value=n});else if(typeaheadUrl.value.length>0){f.value.splice(0);const n=new XMLHttpRequest,s=this;n.onreadystatechange=function(){console.log([readyState,status]),this.readyState==4&&this.status==200&&(s.typeaheadTags=JSON.parse(n.responseText),s.doSearch(l))};const p=typeaheadUrl.value.replace(":search",l);n.open("GET",p,!0),n.send()}else G(l)}S.value=a.value}},G=a=>{r.value=[];for(let l of f.value){const n=t.caseSensitiveTags?l[t.textField]:l[t.textField].toLowerCase(),s=r.value.map(p=>p[t.idField]);n.search(a)>-1&&!E(l)&&!s.includes(l[t.idField])&&r.value.push(l)}t.sortSearchResults&&r.value.sort((l,n)=>l[t.textField]<n[t.textField]?-1:l[t.textField]>n[t.textField]?1:0),t.typeaheadMaxResults>0&&(r.value=r.value.slice(0,t.typeaheadMaxResults))},X=()=>{u.value.length||e.nextTick(()=>{y()})},P=()=>{c.value+1<=r.value.length-1&&c.value++},Y=()=>{c.value>0&&c.value--},y=(a=!1)=>{r.value=[],c.value=0,t.typeaheadAlwaysShow&&e.nextTick(()=>{h()}),a&&T.value.focus()},x=()=>{o.value.splice(0,o.value.length)},C=()=>{if(t.value&&t.value.length){if(!Array.isArray(t.value)){console.error("Voerro Tags Input: the v-model value must be an array!");return}let a=t.value;if(a.value==a)return;x();for(let l of a)v(l,!0)}else{if(o.value.length==0)return;x()}},E=a=>{if(t.allowDuplicates||!a)return!1;const l=g(t.caseSensitiveTags?a[t.textField]:a[t.textField].toLowerCase());for(let n of o.value){const s=t.caseSensitiveTags?n[t.textField]:n[t.textField].toLowerCase();if(n[t.idField]===a[t.idField]&&g(s).length==l.length&&s.search(l)>-1)return!0}return!1},Z=a=>{d("keyup",a)},_=a=>{d("keydown",a)},ee=a=>{d("focus",a),k.value=!0},te=a=>{d("click",a),k.value=!0,h()},ae=a=>{d("blur",a),t.addTagsOnBlur&&t.tagFromInput(!0),t.typeaheadAlwaysShow?h():X(),k.value=!1},le=a=>{if(!t.valueFields)return JSON.stringify(a);const l=t.valueFields.replace(/\s/,"").split(",");return l.length===1?a[l[0]]:JSON.stringify(Object.assign({},...l.map(n=>({[n]:a[n]}))))},ne=a=>t.displayField!==void 0&&t.displayField!==null&&a[t.displayField]!==void 0&&a[t.displayField]!==null&&a[t.displayField]!==""?a[t.displayField]:a[t.textField],M=a=>a.map(l=>Object.assign({},l));return(a,l)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[A,e.createElementVNode("div",L,[e.createElementVNode("div",{class:e.normalizeClass({[i.wrapperClass+" tags-input"]:!0,active:k.value,disabled:i.disabled})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,(n,s)=>(e.openBlock(),e.createElementBlock("span",{key:s,class:e.normalizeClass(["tags-input-badge tags-input-badge-pill tags-input-badge-selected-default",{disabled:i.disabled}])},[e.renderSlot(a.$slots,"selected-tag",{tag:n,index:s,removeTag:w},()=>[e.createElementVNode("span",{innerHTML:n[i.textField]},null,8,I),e.withDirectives(e.createElementVNode("a",{href:"#",class:"tags-input-remove",onClick:e.withModifiers(p=>w(s),["prevent"])},null,8,N),[[e.vShow,!i.disabled]])])],2))),128)),e.withDirectives(e.createElementVNode("input",{type:"text",ref:"taginput",id:i.inputId,name:i.inputId,placeholder:i.placeholder,value:u.value,onInput:l[0]||(l[0]=n=>u.value=n.target.value),onCompositionstart:l[1]||(l[1]=n=>F.value=!0),onCompositionend:l[2]||(l[2]=n=>F.value=!1),onKeydown:[l[3]||(l[3]=e.withKeys(e.withModifiers(n=>q(!1),["prevent"]),["enter"])),e.withKeys(W,["8"]),e.withKeys(P,["down"]),e.withKeys(Y,["up"]),_],onKeyup:[Z,e.withKeys(y,["esc"])],onFocus:ee,onClick:te,onBlur:ae,onValue:l[4]||(l[4]=(...n)=>o.value&&o.value(...n))},null,40,O),[[e.vShow,!e.unref(Q)]]),i.elementId?(e.openBlock(),e.createElementBlock("div",$,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,(n,s)=>(e.openBlock(),e.createElementBlock("input",{key:s,type:"hidden",name:`${i.elementId}[]`,value:le(n)},null,8,D))),128))])):e.createCommentVNode("",!0)],2),e.withDirectives(e.createElementVNode("div",null,[i.typeaheadStyle==="badges"?(e.openBlock(),e.createElementBlock("p",{key:0,class:e.normalizeClass(`typeahead-${i.typeaheadStyle}`)},[i.typeaheadHideDiscard?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",{key:0,class:"tags-input-badge typeahead-hide-btn tags-input-typeahead-item-default",onClick:l[5]||(l[5]=e.withModifiers(n=>y(!0),["prevent"])),textContent:e.toDisplayString(i.discardSearchText)},null,8,R)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,(n,s)=>(e.openBlock(),e.createElementBlock("span",{key:s,innerHTML:n[i.textField],onMouseover:p=>c.value=s,onMousedown:e.withModifiers(p=>B(n),["prevent"]),class:e.normalizeClass(["tags-input-badge",{"tags-input-typeahead-item-default":s!=c.value,"tags-input-typeahead-item-highlighted-default":s==c.value}])},null,42,K))),128))],2)):i.typeaheadStyle==="dropdown"?(e.openBlock(),e.createElementBlock("ul",{key:1,class:e.normalizeClass(`typeahead-${i.typeaheadStyle}`)},[i.typeaheadHideDiscard?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("li",{key:0,class:"tags-input-typeahead-item-default typeahead-hide-btn",onClick:l[6]||(l[6]=e.withModifiers(n=>y(!0),["prevent"])),textContent:e.toDisplayString(i.discardSearchText)},null,8,H)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,(n,s)=>(e.openBlock(),e.createElementBlock("li",{key:s,innerHTML:ne(n),onMouseover:p=>c.value=s,onMousedown:e.withModifiers(p=>B(n),["prevent"]),class:e.normalizeClass({"tags-input-typeahead-item-default":s!=c.value,"tags-input-typeahead-item-highlighted-default":s==c.value})},null,42,V))),128))],2)):e.createCommentVNode("",!0)],512),[[e.vShow,r.value.length]])])],64))}},U=e.createTextVNode(" tags input here: "),j={__name:"App",setup(i){const d=e.ref([]);return(t,o)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[U,e.createVNode(z,{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=u=>d.value=u),placeholder:"Type a tag"},null,8,["modelValue"])],64))}};e.createApp(j).mount("#app")});
