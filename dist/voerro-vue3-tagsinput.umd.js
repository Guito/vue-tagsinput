(function(f,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(f=typeof globalThis<"u"?globalThis:f||self,e(f.TagsInput={},f.Vue))})(this,function(f,e){"use strict";const O={class:"tags-input-root",style:{position:"relative"}},R=["innerHTML"],N=["onClick"],$=["id","name","placeholder","value","onKeydown","onKeyup"],D={key:0,style:{display:"none"}},V=["name","value"],K=["textContent"],H=["innerHTML","onMouseover","onMousedown"],z=["textContent"],j=["innerHTML","onMouseover","onMousedown"],x={__name:"TagsInput",props:{elementId:String,inputId:String,existingTags:{type:Array,default:()=>[]},idField:{type:String,default:"key"},textField:{type:String,default:"value"},displayField:{type:String,default:null},valueFields:{type:String,default:null},disabled:{type:Boolean,default:!1},typeahead:{type:Boolean,default:!1},typeaheadStyle:{type:String,default:"badges"},typeaheadActivationThreshold:{type:Number,default:1},typeaheadMaxResults:{type:Number,default:0},typeaheadAlwaysShow:{type:Boolean,default:!1},typeaheadShowOnFocus:{type:Boolean,default:!0},typeaheadHideDiscard:{type:Boolean,default:!1},typeaheadUrl:{type:String,default:""},typeaheadCallback:{type:Function,default:null},placeholder:{type:String,default:"Add a tag"},discardSearchText:{type:String,default:"Discard Search Results"},limit:{type:Number,default:0},hideInputOnLimit:{type:Boolean,default:!1},onlyExistingTags:{type:Boolean,default:!1},deleteOnBackspace:{type:Boolean,default:!0},allowDuplicates:{type:Boolean,default:!1},validate:{type:Function,default:()=>!0},addTagsOnComma:{type:Boolean,default:!1},addTagsOnSpace:{type:Boolean,default:!1},addTagsOnBlur:{type:Boolean,default:!1},wrapperClass:{type:String,default:"tags-input-wrapper-default"},sortSearchResults:{type:Boolean,default:!0},caseSensitiveTags:{type:Boolean,default:!1},beforeAddingTag:{type:Function,default:()=>!0},beforeRemovingTag:{type:Function,default:()=>!0},modelValue:{type:Array,default:()=>[]},initialValue:{type:Array,default:()=>[]}},emits:["initialized","change","input","limit-reached","tag-added","tags-updated","tag-removed","tags-updated","keyup","keydown","focus","click","blur","update:modelValue"],setup(s,{emit:c}){const t=s,o=e.ref([]),r=e.ref(""),v=e.ref(""),J=e.ref(""),d=e.ref([]),u=e.ref(0),k=e.ref(!1),w=e.ref(!1),h=e.ref(),S=e.ref(null);e.onMounted(()=>{t.initialValue.length&&setTimeout(()=>{for(let a=0;a<t.initialValue.length;a++)F(e.reactive(t.initialValue[a]))},100),h.value=L(e.toRaw(t.existingTags)),A(),t.typeaheadAlwaysShow&&y(),c("initialized"),addEventListener("click",a=>{a.target!==S.value&&g()})});const Q=e.computed(()=>t.hideInputOnLimit&&t.limit>0&&o.value.length>=t.limit||t.disabled);e.watch(r,(a,l)=>{y(),a.length&&a!=l&&(a.substring(l.length,a.length),t.addTagsOnSpace&&a.endsWith(" ")&&(r.value=a.trim(),T(!0)),t.addTagsOnComma&&(a=a.trim(),a.endsWith(",")&&(r.value=a.substring(0,a.length-1),T(!0))),c("change",a))}),e.watch(t.existingTags,a=>{h.value.splice(0),h.value=L(a),y()}),e.watch(o.value,()=>{J.value=JSON.stringify(e.toRaw(o.value)),c("update:modelValue",e.toRaw(o.value))}),e.watch(t.modelValue,()=>{A()}),e.watch(t.typeaheadAlwaysShow,a=>{a?y():g()});const m=a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),T=(a=!1)=>{if(!w.value)if(d.value.length&&u.value>=0&&!a)F(d.value[u.value]),r.value="";else{let l=r.value.trim();if(!t.onlyExistingTags&&l.length&&t.validate(l)){r.value="";let n={[t.idField]:"",[t.textField]:l};const i=m(t.caseSensitiveTags?n[t.textField]:n[t.textField].toLowerCase());for(let p of h.value){const le=m(t.caseSensitiveTags?p[t.textField]:p[t.textField].toLowerCase());if(i===le){n=Object.assign({},p);break}}B(n)}}},C=a=>{F(a),S.value.blur()},F=a=>{g(),B(a),e.nextTick(()=>{r.value="",v.value=""})},B=(a,l=!1)=>{if(!(t.disabled&&!l)){if(!t.beforeAddingTag(a))return!1;if(t.limit>0&&o.value.length>=t.limit)return c("limit-reached"),!1;I(a)||(o.value.push(a),e.nextTick(()=>{c("tag-added",a),c("tags-updated")}))}},q=()=>{!r.value.length&&t.deleteOnBackspace&&o.value.length&&b(o.value.length-1)},b=a=>{if(t.disabled)return;let l=o.value[a];if(!t.beforeRemovingTag(l))return!1;o.value.splice(a,1),e.nextTick(()=>{c("tag-removed",l),c("tags-updated"),t.typeaheadAlwaysShow&&y()})},y=()=>{if(t.typeahead!==!0)return!1;if(v.value!=r.value||!d.value.length&&t.typeaheadActivationThreshold==0||t.typeaheadAlwaysShow||t.typeaheadShowOnFocus){!t.typeaheadUrl.length&&!t.typeaheadCallback&&(d.value=[]),u.value=0;let a=r.value.trim();if(a.length&&a.length>=t.typeaheadActivationThreshold||t.typeaheadActivationThreshold==0||t.typeaheadAlwaysShow){const l=m(t.caseSensitiveTags?a:a.toLowerCase());if(t.typeaheadCallback)t.typeaheadCallback(l).then(n=>{h.value=n});else if(t.typeaheadUrl.length>0){h.value.splice(0);const n=new XMLHttpRequest;n.onreadystatechange=function(){this.readyState==4&&this.status==200&&(h.value=JSON.parse(n.responseText),M(l))};const i=t.typeaheadUrl.replace(":search",l);n.open("GET",i,!0),n.send()}else M(l)}v.value=r.value}},M=a=>{d.value=[];for(let l of h.value){const n=t.caseSensitiveTags?l[t.textField]:l[t.textField].toLowerCase(),i=d.value.map(p=>p[t.idField]);n.search(a)>-1&&!I(l)&&!i.includes(l[t.idField])&&d.value.push(l)}t.sortSearchResults&&d.value.sort((l,n)=>l[t.textField]<n[t.textField]?-1:l[t.textField]>n[t.textField]?1:0),t.typeaheadMaxResults>0&&(d.value=d.value.slice(0,t.typeaheadMaxResults))},W=()=>{r.value.length||e.nextTick(()=>{g()})},G=()=>{u.value+1<=d.value.length-1&&u.value++},P=()=>{u.value>0&&u.value--},g=(a=!1)=>{d.value=[],u.value=0,t.typeaheadAlwaysShow&&e.nextTick(()=>{y()}),a&&S.value.focus()},E=()=>{o.value.splice(0,o.value.length)},A=()=>{if(t.modelValue&&t.modelValue.length){if(!Array.isArray(t.modelValue)){console.error("Tags Input: the v-model value must be an array!");return}let a=t.modelValue;if(a.value==a)return;E();for(let l of a)B(l,!0)}else{if(o.value.length==0)return;E()}},I=a=>{if(t.allowDuplicates||!a)return!1;const l=m(t.caseSensitiveTags?a[t.textField]:a[t.textField].toLowerCase());for(let n of o.value){const i=t.caseSensitiveTags?n[t.textField]:n[t.textField].toLowerCase();if(n[t.idField]===a[t.idField]&&m(i).length==l.length&&i.search(l)>-1)return!0}return!1},X=a=>{c("keyup",a)},Y=a=>{c("keydown",a)},Z=a=>{c("focus",a),k.value=!0},_=a=>{c("click",a),k.value=!0,y()},ee=a=>{c("blur",a),t.addTagsOnBlur&&T(!0),t.typeaheadAlwaysShow?y():W(),k.value=!1},te=a=>{if(!t.valueFields)return JSON.stringify(a);const l=t.valueFields.replace(/\s/,"").split(",");return l.length===1?a[l[0]]:JSON.stringify(Object.assign({},...l.map(n=>({[n]:a[n]}))))},ae=a=>t.displayField!==void 0&&t.displayField!==null&&a[t.displayField]!==void 0&&a[t.displayField]!==null&&a[t.displayField]!==""?a[t.displayField]:a[t.textField],L=a=>a.map(l=>Object.assign({},l));return(a,l)=>(e.openBlock(),e.createElementBlock("div",O,[e.createElementVNode("div",{class:e.normalizeClass({[s.wrapperClass+" tags-input"]:!0,active:k.value,disabled:s.disabled})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,(n,i)=>(e.openBlock(),e.createElementBlock("span",{key:i,class:e.normalizeClass(["tags-input-badge tags-input-badge-pill tags-input-badge-selected-default",{disabled:s.disabled}])},[e.renderSlot(a.$slots,"selected-tag",{tag:n,index:i,removeTag:b},()=>[e.createElementVNode("span",{innerHTML:n[s.textField]},null,8,R),e.withDirectives(e.createElementVNode("a",{href:"#",class:"tags-input-remove",onClick:e.withModifiers(p=>b(i),["prevent"])},null,8,N),[[e.vShow,!s.disabled]])])],2))),128)),e.withDirectives(e.createElementVNode("input",{type:"text",ref_key:"tagInputRef",ref:S,id:s.inputId,name:s.inputId,placeholder:s.placeholder,value:r.value,onInput:l[0]||(l[0]=n=>r.value=n.target.value),onCompositionstart:l[1]||(l[1]=n=>w.value=!1),onCompositionend:l[2]||(l[2]=n=>w.value=!1),onKeydown:[l[3]||(l[3]=e.withKeys(e.withModifiers(n=>T(!1),["prevent"]),["enter"])),e.withKeys(q,["delete"]),e.withKeys(G,["down"]),e.withKeys(P,["up"]),Y],onKeyup:[X,e.withKeys(g,["esc"])],onFocus:Z,onClick:_,onBlur:ee,onValue:l[4]||(l[4]=(...n)=>o.value&&o.value(...n))},null,40,$),[[e.vShow,!e.unref(Q)]]),s.elementId?(e.openBlock(),e.createElementBlock("div",D,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,(n,i)=>(e.openBlock(),e.createElementBlock("input",{key:i,type:"hidden",name:`${s.elementId}[]`,value:te(n)},null,8,V))),128))])):e.createCommentVNode("",!0)],2),e.withDirectives(e.createElementVNode("div",null,[s.typeaheadStyle==="badges"?(e.openBlock(),e.createElementBlock("p",{key:0,class:e.normalizeClass(`typeahead-${s.typeaheadStyle}`)},[s.typeaheadHideDiscard?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",{key:0,class:"tags-input-badge typeahead-hide-btn tags-input-typeahead-item-default",onClick:l[5]||(l[5]=e.withModifiers(n=>g(!0),["prevent"])),textContent:e.toDisplayString(s.discardSearchText)},null,8,K)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,(n,i)=>(e.openBlock(),e.createElementBlock("span",{key:i,innerHTML:n[s.textField],onMouseover:p=>u.value=i,onMousedown:e.withModifiers(p=>C(n),["prevent"]),class:e.normalizeClass(["tags-input-badge",{"tags-input-typeahead-item-default":i!=u.value,"tags-input-typeahead-item-highlighted-default":i==u.value}])},null,42,H))),128))],2)):s.typeaheadStyle==="dropdown"?(e.openBlock(),e.createElementBlock("ul",{key:1,class:e.normalizeClass(`typeahead-${s.typeaheadStyle}`)},[s.typeaheadHideDiscard?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("li",{key:0,class:"tags-input-typeahead-item-default typeahead-hide-btn",onClick:l[6]||(l[6]=e.withModifiers(n=>g(!0),["prevent"])),textContent:e.toDisplayString(s.discardSearchText)},null,8,z)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,(n,i)=>(e.openBlock(),e.createElementBlock("li",{key:i,innerHTML:ae(n),onMouseover:p=>u.value=i,onMousedown:e.withModifiers(p=>C(n),["prevent"]),class:e.normalizeClass({"tags-input-typeahead-item-default":i!=u.value,"tags-input-typeahead-item-highlighted-default":i==u.value})},null,42,j))),128))],2)):e.createCommentVNode("",!0)],512),[[e.vShow,d.value.length]])]))}},U={install:s=>{s.component("TagsInput",x)}};f.TagsInput=x,f.default=U,Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
